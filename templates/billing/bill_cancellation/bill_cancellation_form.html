{% extends 'semantic-ui/layouts/base.html' %}
{% load static %}

{% block title %} Bill Cancellation Form {% endblock title %}

{% block extrastyle %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<style>
    .select2-container { width: 100% !important; }
    /* Align Select2 with Semantic UI input height a bit better */
    .select2-container--default .select2-selection--single { height: 38px; padding: 4px 8px; }
    .select2-container--default .select2-selection--single .select2-selection__arrow { height: 36px; }
</style>
{% endblock extrastyle %}

{% block content %}
<div class="sixteen wide column">
    <div class="ui clearing basic segment">
        <h1 class="ui left floated header">
            {% if is_update %}Update Bill Cancellation{% else %}Cancel Bill{% endif %}
        </h1>
    </div>

    <!-- Messages Block -->
    {% if messages %}
    <div class="ui floating message">
        <i class="close icon"></i>
        <div class="ui middle aligned animated divided list">
            {% for message in messages %}
            <div class="item {{ message.tags }}">
                <p>{{ message }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}
    <!-- End of Messages Block -->
     
    <form class="ui form" method="post"
        action="{% if is_update %}{% url 'billing:cancelled-bill-update' cancelledbill.pk %}{% else %}{% url 'billing:cancelled-bill-create' %}{% endif %}">
        {% csrf_token %}
        {% for field in form %}
        <div class="field">
            <label for="{{ field.id_for_label }}">{{ field.label }}</label>
            {% if field.field.widget.input_type == 'checkbox' %}
            <div class="ui segment">
                <div class="field">
                    <div class="ui toggle checkbox">
                    {{ field }}
                    <label for="{{ field.id_for_label }}">{{ field.label }}</label>
                    </div>
                    <!-- Field errors -->
                    {% if field.errors %}
                    <div class="ui error message">
                    <ul class="ui list">
                        {% for error in field.errors %}
                        <li class="item">{{ error }}</li>
                        {% endfor %}
                    </ul>
                    </div>
                    {% endif %}
                    <!-- End field errors -->
                </div>
            </div>
            {% else %}
            <div class="field">
                {{ field }}
                <!-- Field errors -->
                {% if field.errors %}
                <div class="ui error message">
                    <ul class="ui list">
                        {% for error in field.errors %}
                        <li class="item">{{ error }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
                <!-- End field errors -->
            </div>
            {% endif %}
        </div>
        {% endfor %}
        <button class="ui submit button" type="submit">
            {% if is_update %}Update{% else %}Cancel Bill{% endif %}
        </button>
    </form>
</div>
{% endblock content %}

{% block extrascript %}
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<script>
    $(function () {
        const $bill = $('#id_bill');
        if (!$bill.length) return;

        $bill.select2({
            placeholder: $bill.data('placeholder') || 'Search bill...',
            allowClear: true,
            ajax: {
                url: "{% url 'billing:bill-search' %}",
                dataType: 'json',
                delay: 250,
                data: function (params) {
                    return { q: params.term || '', page: params.page || 1 };
                },
                processResults: function (data) {
                    return data;
                },
                cache: true
            }
        });
    });
</script>
{% endblock extrascript %}
